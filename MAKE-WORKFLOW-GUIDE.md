# Make.com 워크플로우 설정 가이드

## 개요
Insuniverse 데이터 수집 → JSON 처리 → 노션 데이터베이스 자동 입력 워크플로우

## 1. Make.com 시나리오 구성

### 1.1 웹훅 트리거 설정
1. **새 시나리오 생성**
2. **Webhook** 모듈 추가 → **Incoming webhook** 선택
3. **웹훅 URL 복사** → `.env` 파일의 `MAKE_WEBHOOK_URL`에 입력

### 1.2 JSON 파서 모듈 추가
1. **JSON** 모듈 추가 → **Parse JSON** 선택
2. **JSON string**: `{{1.data}}` (웹훅에서 받은 데이터)
3. **Data structure**: 아래 샘플 JSON 구조 입력

```json
{
  "timestamp": "2025-09-12T11:15:35.000Z",
  "source": "insuniverse-automation",
  "jobId": 1,
  "notion": {
    "database_id": "8b0f4a5e-29e4-4534-b7e2-68288a64adcd",
    "properties": {
      "고객명": "김지훈",
      "전화번호": "01020221053",
      "분석ID": 10106,
      "분석상태": "분석완료"
    }
  },
  "raw_data": {
    "customer": {},
    "metadata": {},
    "api_summary": {}
  },
  "detailed_analysis": {
    "diseases": [],
    "operations": [],
    "insurance_insights": []
  }
}
```

### 1.3 노션 데이터베이스 입력 모듈
1. **Notion** 모듈 추가 → **Create a Database Item** 선택
2. **Database ID**: `8b0f4a5e-29e4-4534-b7e2-68288a64adcd`
3. **Properties 매핑**:

| 노션 필드 | Make.com 매핑 | 타입 |
|-----------|---------------|------|
| 고객명 | `{{2.notion.properties.고객명}}` | Title |
| 전화번호 | `{{2.notion.properties.전화번호}}` | Phone |
| 생년월일 | `{{2.notion.properties.생년월일}}` | Text |
| 분석ID | `{{2.notion.properties.분석ID}}` | Number |
| 분석상태 | `{{2.notion.properties.분석상태}}` | Select |
| 분석완료일 | `{{2.notion.properties.date:분석완료일:start}}` | Date |
| 수집일시 | `{{2.notion.properties.date:수집일시:start}}` | Date |
| 질병미보유자수 | `{{2.notion.properties.질병미보유자수}}` | Number |
| 질병보유자수 | `{{2.notion.properties.질병보유자수}}` | Number |
| 건강보험항목수 | `{{2.notion.properties.건강보험항목수}}` | Number |
| 일반분석항목수 | `{{2.notion.properties.일반분석항목수}}` | Number |
| 주요질병코드 | `{{2.notion.properties.주요질병코드}}` | Text |
| 보험진단가능성 | `{{2.notion.properties.보험진단가능성}}` | Text |
| PDF보고서 | `{{2.notion.properties.PDF보고서}}` | Checkbox |
| 처리상태 | `{{2.notion.properties.처리상태}}` | Select |
| Make작업ID | `{{2.jobId}}` | Number |

## 2. 고급 워크플로우 (선택사항)

### 2.1 조건부 처리
- **Router** 모듈로 성공/실패 분기 처리
- **Filter**: `{{2.notion.properties.처리상태}} = "처리완료"`

### 2.2 알림 설정
1. **Email** 모듈: 데이터 수집 완료 알림
2. **Slack** 모듈: 팀 채널에 결과 공유
3. **Discord** 모듈: 개인 알림

### 2.3 데이터 백업
1. **Google Sheets** 모듈: 백업 스프레드시트에 추가
2. **Google Drive** 모듈: 원본 JSON 파일 저장

## 3. 워크플로우 테스트

### 3.1 테스트 데이터 전송
웹 폼에서 다음 정보로 테스트:
- **고객명**: 김지훈
- **전화번호**: 010-2022-1053
- **Make.com 웹훅 URL**: (생성된 웹훅 URL)

### 3.2 확인사항
1. ✅ 웹훅이 데이터를 정상 수신했는지
2. ✅ JSON 파싱이 올바르게 되었는지  
3. ✅ 노션 데이터베이스에 레코드가 생성되었는지
4. ✅ 모든 필드가 올바르게 매핑되었는지

## 4. 데이터 활용 방안

### 4.1 노션에서 바로 확인 가능한 정보
- **고객 기본 정보**: 이름, 전화번호, 생년월일
- **분석 현황**: 상태, 완료일, 데이터 수집일
- **의료 데이터 요약**: 질병 개수, 보험 항목 수
- **핵심 인사이트**: 주요 질병, 보험 진단 가능성

### 4.2 추가 분석 가능한 데이터
- **질병 트렌드**: 질병 코드별 빈도 분석
- **보험 추천**: 진단 가능성 기반 상품 매칭
- **비용 예측**: 의료비 패턴 분석

### 4.3 보고서 생성
- **월간 리포트**: 수집된 고객 분석 현황
- **질병 통계**: 가장 흔한 질병 코드 및 보험 니즈
- **성과 측정**: 데이터 수집 성공률, 처리 시간

## 5. 자동화 스케줄링 (선택사항)

### 5.1 정기 수집
- **Schedule** 모듈로 주기적 실행
- 기존 고객 데이터 업데이트 확인
- 새로운 분석 결과 자동 수집

### 5.2 알림 및 모니터링  
- **Webhook 실패 시**: 슬랙 알림
- **데이터 이상 시**: 이메일 알림
- **일일 요약 리포트**: 자동 생성

## 6. 보안 고려사항

### 6.1 민감 정보 처리
- **전화번호**: 마스킹 처리 옵션
- **생년월일**: 연도만 저장 옵션
- **의료 정보**: 접근 권한 제한

### 6.2 데이터 보관
- **자동 삭제**: 일정 기간 후 자동 삭제
- **암호화**: 민감 데이터 암호화 저장
- **로그 관리**: 접근 기록 추적

## 7. 문제 해결

### 7.1 일반적인 오류들
- **웹훅 타임아웃**: 응답 시간 초과 → 타임아웃 설정 조정
- **JSON 파싱 오류**: 데이터 구조 변경 → 스키마 업데이트  
- **노션 필드 오류**: 타입 불일치 → 데이터 검증 추가

### 7.2 디버깅 방법
- **Make.com 로그**: 각 모듈별 실행 결과 확인
- **웹훅 테스트**: 수동으로 테스트 데이터 전송
- **노션 확인**: 데이터베이스에서 직접 확인

---

**생성된 노션 데이터베이스 URL**: https://www.notion.so/68206104bd0e4d9baf1cb705d765ea31

이제 웹 폼에서 고객 정보를 입력하면 → 자동으로 노션 데이터베이스에 정리된 상태로 저장됩니다!